var PBApp=angular.module("PBApp",["ngRoute"]);PBApp.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"app/components/bookmarks/bookmarksView.html",controller:"BookmarksController"}).when("/article/:articleId",{templateUrl:"/app/components/article/articleView.html",controller:"ArticleController"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})}),PBApp.controller("ArticleController",["$scope","$http","$routeParams","$sce","$localStorage",function($scope,$http,$routeParams,$sce,$localStorage){$scope.$routeParams=$routeParams,$scope.init=function(){$scope.getArticle()},$scope.getArticle=function(){var articleId=$scope.$routeParams.articleId,localArticle=$localStorage.getObject("article"+articleId);0!=Object.keys(localArticle).length?$scope.displayArticle():$http({method:"GET",url:"/api/article?id="+articleId}).then(function(response){$localStorage.setObject("article"+$scope.$routeParams.articleId,response.data),$scope.displayArticle()})},$scope.displayArticle=function(){var articleId=$scope.$routeParams.articleId,localArticle=$localStorage.getObject("article"+articleId);$scope.article=localArticle,$scope.articleContent=$sce.trustAsHtml(localArticle.content)}}]),PBApp.factory("$localStorage",["$window",function($window){return{set:function(key,value){$window.localStorage[key]=value},get:function(key,defaultValue){return $window.localStorage[key]||defaultValue},setObject:function(key,value){$window.localStorage[key]=JSON.stringify(value)},getObject:function(key){return JSON.parse($window.localStorage[key]||"{}")}}}]),PBApp.controller("BookmarksController",["$scope","$http","$sce",function($scope,$http,$sce){$scope.init=function(){$scope.getBookmarks()},$scope.getBookmarks=function(){$scope.bookmarks=[],$http({method:"GET",url:"/api/bookmarks"}).then(function(response){$scope.displayBookmarks(response.data.bookmarks)})},$scope.displayBookmarks=function(data){for(var i=0;i<data.length;i++)data[i].article.excerpt=$sce.trustAsHtml(data[i].article.excerpt),$scope.bookmarks.push(data[i])},$scope.addBookmark=function(){var url=$scope.bookmark.url;$http({method:"POST",url:"/api/bookmarks",data:{url:url}}).then(function(response){$scope.updateBookmarks(response.data),$scope.bookmark.url=""})},$scope.updateBookmarks=function(data){data.article.excerpt=$sce.trustAsHtml(data.article.excerpt),$scope.bookmarks.unshift(data)}}]);